{% extends "abase.html" %}
{% block title %}Home{% endblock %}
{% block content %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/a_order.css' %}">
<div class="main">
    <h2>Order Details</h2>

    <!-- Filter and Download Excel Container -->
    <div class="filter-container">
        <div class="filters">
            <label for="state">State:</label>
            <select id="state" onchange="loadDistricts()">
                <option value="">Select State</option>
            </select>

            <label for="district">District:</label>
            <select id="district" disabled onchange="loadTaluks()">
                <option value="">Select District</option>
            </select>

            <label for="taluk">Taluk:</label>
            <select id="taluk" disabled>
                <option value="">Select Taluk</option>
            </select>

            <label for="from-date">From Date:</label>
            <input type="date" id="from-date">

            <label for="to-date">To Date:</label>
            <input type="date" id="to-date">

            <button class="go-btn" onclick="applyFilters()">Go</button>
        </div>

        <button class="download-btn">Download Excel</button>
    </div>

    <!-- Order table -->
    <table>
        <thead>
            <tr>
                <th>Order ID</th>
                <th>Customer</th>
                <th>Driver</th>
                <th>Vehicle</th>
                <th>Date</th>
                <th>From</th>
                <th>To</th>
                <th>Purpose</th>
                <th>Item Name</th>
                <th>Load (Kg)</th>
                <th>Load Image</th>
                <th>Services</th>
                <th>Distance (km)</th>
                <th>Status</th>
                <th>Price</th>
                <th>Processing Fee</th>
                
            </tr>
        </thead>
        <tbody id="order-data">
            <!-- Orders will be populated here -->
            {% for order in orders %}
            <tr>
                <td>{{ order.order_id }}</td>
                <td>{{ order.customer }}</td>
                <td>{{ order.driver }}</td>
                <td>{{ order.vehicle }}</td>
                <td>{{ order.date }}</td>
                <td>{{ order.from_location }}</td>
                <td>{{ order.to_location }}</td>
                <td>{{ order.purpose }}</td>
                <td>{{ order.item_name }}</td>
                <td>{{ order.load_kg }}</td>
                <td>
                    {% if order.load_image%}
                    <img src="{{ order.load_image.url }}" alt="Load Image" width="50">
                    {% else %}
                    N/A
                    {% endif %}
                </td>
                <td>{{ order.services }}</td>
                <td>{{ order.distance|floatformat:2 }}</td>
                <td>{{ order.get_status_display }}</td>
                <td>{{ order.price }}</td>
                <td>{{ order.processing_fee }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
    const regionData = {
        "Andhra Pradesh": {
            "Anantapur": ["Taluk 1", "Taluk 2", "Taluk 3"],
            "Chittoor": ["Taluk 1", "Taluk 2"]
        },
        "Karnataka": {
            "Bangalore": ["Bangalore East", "Bangalore West"],
            "Mysore": ["Taluk 1", "Taluk 2"]
        },
        // Add more states, districts, and taluks here
    };

    // Populate the state dropdown
    const stateSelect = document.getElementById('state');
    const districtSelect = document.getElementById('district');
    const talukSelect = document.getElementById('taluk');

    function populateStates() {
        for (let state in regionData) {
            let option = document.createElement('option');
            option.value = state;
            option.textContent = state;
            stateSelect.appendChild(option);
        }
    }

    // Load districts based on state selection
    function loadDistricts() {
        districtSelect.innerHTML = '<option value="">Select District</option>';
        talukSelect.innerHTML = '<option value="">Select Taluk</option>';
        talukSelect.disabled = true;

        let selectedState = stateSelect.value;
        if (selectedState) {
            districtSelect.disabled = false;
            for (let district in regionData[selectedState]) {
                let option = document.createElement('option');
                option.value = district;
                option.textContent = district;
                districtSelect.appendChild(option);
            }
        } else {
            districtSelect.disabled = true;
            talukSelect.disabled = true;
        }
    }

    // Load taluks based on district selection
    function loadTaluks() {
        talukSelect.innerHTML = '<option value="">Select Taluk</option>';

        let selectedState = stateSelect.value;
        let selectedDistrict = districtSelect.value;

        if (selectedDistrict) {
            talukSelect.disabled = false;
            let taluks = regionData[selectedState][selectedDistrict];
            taluks.forEach(taluk => {
                let option = document.createElement('option');
                option.value = taluk;
                option.textContent = taluk;
                talukSelect.appendChild(option);
            });
        } else {
            talukSelect.disabled = true;
        }
    }

    // Apply filters (Placeholder functionality)
    function applyFilters() {
        alert("Filters applied!");
    }

    // Initialize the state dropdown on page load
    window.onload = populateStates;
</script>
{% endblock content %}