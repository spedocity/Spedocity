{% extends "vbase.html" %}
{% block title %}Vehicle Registration{% endblock %}
{% block content %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/vechile.css' %}">

<div class="container">
    <h2>Vehicle Registration</h2>
    <form action="{% url 'v_vech_reg' %}" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        
        <!-- Phone Number -->
        <div class="form-group">
            <label for="phoneNumber">Phone Number:</label>
            <input type="tel" id="phoneNumber" name="phoneNumber" placeholder="Enter the Registered Phone No" required>
        </div>
    
        <!-- Vehicle Number -->
        <div class="form-group">
            <label for="vehicleNumber">Vehicle Number:</label>
            <input type="text" id="vehicleNumber" name="vehicleNumber" placeholder="Enter the Vehicle Registered No (e.g., KA 01 HL 0000)" required>
        </div>
    
        <!-- Vehicle Name -->
        <div class="form-group">
            <label for="vehicleName">Vehicle Name:</label>
            <input type="text" id="vehicleName" name="vehicleName" placeholder="Enter the Vehicle Name" required>
        </div>
    
        <!-- Owner Name -->
        <div class="form-group">
            <label for="ownerName">Owner Name:</label>
            <input type="text" id="ownerName" name="ownerName" placeholder="Enter the Owner Name" required>
        </div>
    
        <!-- Vehicle Type -->
        <div class="form-group">
            <label for="vehicleType">Vehicle Type:</label>
            <select id="vehicleType" name="vehicleType" required>
                <option value="">Select Vehicle Type</option>
                <option value="3-wheeler">3-wheeler</option>
                <option value="4-wheeler">4-wheeler</option>
                <option value="6-wheeler">6-wheeler</option>
            </select>
        </div>
    
        <!-- Vehicle Purpose -->
        <div class="form-group">
            <label for="vehiclePurpose">Vehicle Purpose:</label>
            <select id="vehiclePurpose" name="vehiclePurpose" required>
                <option value="">Select Purpose</option>
                <option value="passenger">Passenger</option>
                <option value="logistics">Logistics</option>
                <option value="ambulance">Ambulance</option>
            </select>
        </div>
    
        <!-- Vehicle Photo -->
        <div class="form-group">
            <label for="vehiclePhoto">Vehicle Photo:</label>
            <input type="file" id="vehiclePhoto" name="vehiclePhoto" accept="image/*" required>
        </div>
    
        <!-- Load Capacity -->
        <div class="form-group">
            <label for="loadCapacity">Load Capacity (in KG):</label>
            <input type="number" id="loadCapacity" name="loadCapacity" placeholder="Enter the Load Capacity in KG" min="0" step="10">
        </div>
    
        <!-- RC Card -->
        <div class="form-group">
            <label for="rcCard">RC Card:</label>
            <input type="file" id="rcCard" name="rcCard" accept=".pdf,.jpg,.jpeg,.png" required>
        </div>
    
        <!-- Insurance Document -->
        <div class="form-group">
            <label for="insurance">Insurance Document:</label>
            <input type="file" id="insurance" name="insurance" accept=".pdf,.jpg,.jpeg,.png" required>
        </div>
    
        <!-- Current Location -->
        <div class="form-group">
            <label for="currentLocation">Current Location:</label>
            <input type="text" id="currentLocation" name="currentLocation" placeholder="Enter the Current Location" required>
            <p class="get-location" onclick="getCurrentLocation()">Use Current Location</p>
        </div>
    
        <!-- State -->
        <div class="form-group">
            <label for="state">State:</label>
            <input type="text" id="state" name="state" placeholder="Enter the State" required>
        </div>
    
        <!-- District -->
        <div class="form-group">
            <label for="district">District:</label>
            <input type="text" id="district" name="district" placeholder="Enter the District" required>
        </div>
    
        <!-- Taluk/Town -->
        <div class="form-group">
            <label for="talukTown">Taluk/Town:</label>
            <input type="text" id="talukTown" name="talukTown" placeholder="Enter the Taluk or Town" required>
        </div>
    
        <button type="submit">Register</button>
    </form>
</div>
<script>
    function getCurrentLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                const latitude = position.coords.latitude;
                const longitude = position.coords.longitude;
                const apiKey = 'AIzaSyD2aKVzC3za4z7PzGuiHh0evvFdx4agki0'; // Replace with your Google API key

                // API URL for Google Geocoding
                const url = `https://maps.googleapis.com/maps/api/geocode/json?latlng=${latitude},${longitude}&key=${apiKey}`;

                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === "OK" && data.results.length > 0) {
                            const location = data.results[0].formatted_address;
                            document.getElementById("currentLocation").value = location;
                        } else {
                            alert("Unable to retrieve location information.");
                        }
                    })
                    .catch(error => {
                        console.error("Error fetching location:", error);
                        alert("Failed to retrieve location. Please try again.");
                    });
            }, function(error) {
                alert("Unable to retrieve your location. Please make sure location services are enabled.");
            });
        } else {
            alert("Geolocation is not supported by this browser.");
        }
    }
    document.getElementById('vehiclePurpose').addEventListener('change', function() {
        var loadCapacityInput = document.getElementById('loadCapacity');
        if (this.value === 'passenger' || this.value === 'ambulance') {
            loadCapacityInput.value = 0;
            loadCapacityInput.disabled = true;
        } else {
            loadCapacityInput.value = '';
            loadCapacityInput.disabled = false;
        }
    });
</script>
{% endblock %}