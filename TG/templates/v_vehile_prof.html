{% extends "vbase.html" %}
{% block title %}Home{% endblock %}
{% block content %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/v_v_prof.css' %}">
{% if vehicle %}
<!-- Profile Container - shown if vehicle is registered -->
<div class="profile-container">
    <h1 class="page-title">Vehicle Profile</h1>
    <div class="profile-photo">
        <h2>Vehicle Profile Photo</h2>
        <img src="{{ vehicle.photo.url }}" alt="Vehicle Profile Picture">
    </div>
    <div class="vehicle-details">
        <h2>Vehicle Information:</h2>
        <p><strong>Vehicle Name:</strong> {{ vehicle.name }}</p>
        <p><strong>Owner Name:</strong> {{ vehicle.owner_name }}</p>
        <p><strong>Vehicle Type:</strong> {{ vehicle.vehicle_type }}</p>
        <p><strong>Vehicle ID:</strong> {{ vehicle.vehicle_id }}</p>

        <!-- Conditionally display load capacity for logistics vehicles only -->
        <p><strong>Vehicle Purpose:</strong> {{ vehicle.get_vehicle_purpose_display }}</p>
        {% if vehicle.vehicle_purpose == 'logistics' %}
            <p><strong>Load Capacity:</strong> {{ vehicle.load_capacity }} kg</p>
        {% endif %}
        
        <p><strong>Location:</strong> {{ vehicle.location }}</p>
        <p><strong>Vehicle Status:</strong> {{ vehicle.status }}</p>

        <p><strong>RC Card:</strong> <a href="{{ vehicle.rc_card.url }}" target="_blank">View Document</a></p>
        <p><strong>Insurance Document:</strong> <a href="{{ vehicle.insurance.url }}" target="_blank">View Document</a></p>

        <!-- Button container for Go Back and Delete Vehicle -->
        <div class="button-container">
            <button class="back-button" onclick="window.location.href='{% url 'vhome' %}';">Go Back</button>
            {% if vehicle.id %}
            <button class="delete-button" onclick="confirmDelete({{ vehicle.id }})">Delete Vehicle</button>
            {% endif %}
        </div>
    </div>
</div>
{% else %}
<!-- Add Vehicle Section - shown if no vehicle is registered -->
<div class="add-vehicle-container">
    <h4>No Vehicle Registered</h4>
    <a href="{% url 'v_vech_reg' %}" class="add-vehicle">Add a Vehicle</a>
</div>
{% endif %}
<div class="trip-details-section">
    <div class="trip-details-left">
        <h4>Today's Information</h4>
        <p><strong>Total Trips Today:</strong> {{ today_total_trips }} trips</p>
        <p><strong>Distance Covered Today:</strong> {{ today_total_distance }} km</p>
        <p><strong>Total Earnings Today:</strong> ₹{{ today_total_earnings }}</p>
    </div>
    <div class="trip-details-right">
        <h4>Total Information</h4>
        <p><strong>Overall Trips Covered:</strong> {{ overall_trips }} trips</p>
        <p><strong>Total Distance Covered:</strong> {{ overall_distance }} km</p>
        <p><strong>Total Earnings:</strong> ₹{{ overall_earnings }}</p>
    </div>
</div>
<script>
    function confirmDelete(vehicleId) {
        if (confirm("Are you sure you want to delete this vehicle?")) {
            $.ajax({
                url: `{% url 'delete_vehicle' vehicle_id=0 %}`.replace('0', vehicleId),
                type: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'  // Include CSRF token
                },
                success: function(response) {
                    if (response.success) {
                        alert(response.message);
                        window.location.href = '{% url "vhome" %}';
                    } else {
                        alert("Error: " + response.message);
                    }
                },
                error: function() {
                    alert("An error occurred while trying to delete the vehicle.");
                }
            });
        }
    }
</script>
{% endblock content %}